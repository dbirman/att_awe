---
title: "reactionTime"
author: "Dan Birman"
date: "January 22, 2015"
output: html_document
---

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(lme4)
library(effects)
```

```{r}
cleanup <- function(data) {
  data %>% 
    filter(!is.nan(response)) %>%
    mutate(RT = RT*1000,correct=factor(correct,levels=c(0,1),labels=c("inc","cor"))) %>%
    mutate(taskf = factor(task,levels=c(1,2),labels=c('noise','contrast'))) %>%
    mutate(dualf = factor(dual,levels=c(0,1),labels=c('single','dual'))) %>%
    mutate(index = 1:nrow(.)) %>%
    select(-task,-dual)
}
```

Let's start loading our data

```{r}

filesToLoad = 1:52

for (fi in filesToLoad) {
  # Dealing with run # fi
  main = read.csv(sprintf('../analysis/s300/csv/main%02.f.csv',fi))
  per = read.csv(sprintf('../analysis/s300/csv/per%02.f.csv',fi))
  run = read.csv(sprintf('../analysis/s300/csv/run%02.f.csv',fi))
  
  # Switch to determine what kind of analysis we do
  main = main %>% 
    mutate(dual=run$dual,task=run$blockType,runNum=fi)
  
  per = per %>% 
    mutate(dual=run$dual,task=run$blockType,runNum=fi) %>%
    rename(trial=mainTrial)
  
  if (fi==1) {
    mdata = main
    pdata = per
  } else {
    mdata = rbind(mdata,main)
    pdata = rbind(pdata,per)
  }
}

pdata = pdata %>%
  mutate(respond=factor(respond,levels=c(0,1),labels=c('no','yes'))) %>%
  mutate(tGen=factor(tGen,levels=c(1,2),labels=c('f','m')))

# Do a final cleanup
mdata = cleanup(mdata)
pdata = cleanup(pdata)
```

# Peripheral Main Merge!!

NOT FUNCTIONAL YET... Not totally clear how to do this? You need to use trial==mainTrial but only within each subset of runNum.

```{r}

# mpdata = semi_join(mdata,pdata,by='runNum')
```

Custom changes to mdata
```{r}
mdata = mdata %>%
  mutate(cues = factor(cues,levels=c(1,4),labels=c('1','4')))
```


Now let's start the analysis, using `mdata` and `pdata`. 

Is there a difference in response speed for noise vs. contrast, single vs. dual
```{r}
mdata %>%
  ggplot(aes(ped,RT,color=correct)) +
  geom_point() +
  geom_smooth(method="lm") +
  facet_grid(taskf~dualf) +
  theme_bw()
out1 = lmer(data=mdata,RT ~ taskf + dualf + ped + correct + index + (1|img))
out1 %>%
  summary ->
  rs
rs
```

The coefficients for each condition were, pededestal effect (per ped): `round(rs$coeffficients['ped',],2)`, dual task effect (dual): `round(rs$coeffficients['dualfdual',],2)`, correct effect (cor-inc): `round(rs$coeffficients['correctcor',],2)`, time effect (entire experiment): `round(rs$coeffficients['index',],2)`.

```{r}
plot(allEffects(out1))
```

```{r}
# peripheral task
pdata %>%
  ggplot(aes(tImg,RT,color=dualf)) +
  geom_point() +
  facet_grid(.~dualf) +
  ggtitle('Peripheral')
out2 = lmer(data=pdata,RT ~ dualf + correct + respond + SOA + tGen + index + (1|tImg),na.action=na.omit)
out2 %>%
  summary
plot(allEffects(out2))

# Not in a subset of trials "mainTrial" shows no effect
```



# Correct Dependencies

Does being correct depend on anything?

```{r}
out3 = mdata %>%
  glm(data=.,correct ~ interval + index + taskf + dualf + cues,family='binomial')
out3 %>%
  summary
plot(allEffects(out3))
# plot(allEffects(glm(data=mdata,correct~interval,family='binomial')))
```

```{r}
str(out4 = pdata %>%
  glm(data=.,correct ~ position + respond + tGen + SOA + taskf + dualf + index,family='binomial')
out4 %>%
  summary
plot(allEffects(out4))
```

